# libcoro

This C-library implements coroutines (cooperative multitasking) in a portable fashion.
This repository is forked from the CVS repo at http://software.schmorp.de/pkg/libcoro.html.

## Changes

This fork does not change the functionality of libcoro, it only adds support for `meson`.
The biggest change is the addition of `coroconfig.h`, a header file which is generated by meson and included in `coro.h`.
`coroconfig.h` specifies which backend libcoro should use.
This is to ensure that the both the header file will use the same defines as the static library, when it's included in the parent project.

The `conftest.c` file was also removed because the core of its functionality is implemented in `meson.build`.

## Usage

To build libcoro you can do `meson builddir [OPTIONS...]`.
libcoro has four options:

- `-Dstackalloc`: include the stack `coro_stack_alloc` and `coro_stack_free` functions, this is on by default. 
- `-Dvalgrind`: when stackalloc is on, include `valgrind/valgrind.h` and register and unregister stacks with valgrind.
- `-Dguardpages`: when stackalloc is on, the number of guard pages to use around the stacks, 0 by default, on some platforms this is unsupported.
- `-Dcoro_backend`: the backend to use (see backends), `auto` by default.

## Backends

these are the options for `-Dcoro_backend`, most of these descriptions were taken from the original `coro.h`.

### ucontext

This flavour uses SUSv2's get/set/swap/makecontext functions that
unfortunately only some unices support, and is quite slow.

### setjmp

This flavour uses SUSv2's setjmp/longjmp and sigaltstack functions to do it's job.
Coroutine creation is much slower than UCONTEXT, but context switching is a bit cheaper. 
It should work on almost all unices.

### fiber
Slower, but probably more portable variant for the Microsoft operating system, using fibers. Ignores the passed stack and allocates it internally.
Also, due to bugs in cygwin, this does not work with cygwin.

### asm
Hand coded assembly, known to work only on a few architectures/ABI:
GCC + arm7/x86/IA32/amd64/x86_64 + GNU/Linux and a few BSDs. Fastest choice, if it works.

### pthread
Use the pthread API.
This is likely the slowest backend, and it also does not support fork(), so avoid it at all costs.

### auto

Try to find the best option automatically.

# Original README

Configuration, documentation etc. is provided in the coro.h file.  Please
note that the file conftest.c in this distribution is under the GPL. It is
not needed for proper operation of this library though, for that, coro.h
and coro.c suffice.

Marc Lehmann <schmorp@schmorp.de>
